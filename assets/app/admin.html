<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shamor Admin Dashboard</title>

<style>
:root {
  --primary:#7c5cff;
  --bg:#0f1220;
  --glass:rgba(255,255,255,.08);
  --text:#eaeaff;
  --danger:#ef4444;
  --success:#22c55e;
}

* {
  box-sizing:border-box;
  font-family:system-ui,sans-serif;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
}

/* ===== LAYOUT ===== */
.container {
  padding:1.5rem;
  max-width:1200px;
  margin:auto;
}

/* ===== HEADER ===== */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:1.5rem;
}

header h1 {
  font-size:1.4rem;
}

/* ===== STATS ===== */
.stats {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:1rem;
  margin-bottom:2rem;
}

.stat {
  background:var(--glass);
  padding:1.2rem;
  border-radius:16px;
  backdrop-filter:blur(12px);
}

/* ===== CARD ===== */
.card {
  background:var(--glass);
  padding:1rem;
  border-radius:16px;
  backdrop-filter:blur(12px);
}

/* ===== TABLE ===== */
table {
  width:100%;
  border-collapse:collapse;
}

th,td {
  padding:.75rem;
  font-size:.9rem;
}

th {
  opacity:.8;
}

tr:not(:last-child) {
  border-bottom:1px solid rgba(255,255,255,.08);
}

/* ===== BADGES ===== */
.badge {
  padding:.25rem .6rem;
  border-radius:8px;
  font-size:.75rem;
}

.pending { background:#f59e0b; color:black; }
.approved { background:var(--success); color:black; }
.rejected { background:var(--danger); color:white; }

/* ===== BUTTONS ===== */
.btn {
  padding:.4rem .7rem;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-size:.85rem;
}

.approve {
  background:var(--success);
  color:black;
}

.reject {
  background:var(--danger);
  color:white;
  margin-left:.3rem;
}

.view {
  background:#1f2937;
  color:white;
}

/* ===== MODAL ===== */
.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal-content {
  background:var(--bg);
  padding:1.5rem;
  border-radius:16px;
  width:90%;
  max-width:480px;
}

.modal-content textarea {
  width:100%;
  height:90px;
  margin-top:.5rem;
  border-radius:10px;
  border:none;
  padding:.6rem;
}

.modal-content button {
  width:100%;
  margin-top:.8rem;
  padding:.7rem;
}
</style>
</head>

<body>

<div class="container">

<header>
  <h1>üßë‚Äçüíº Shamor Admin Dashboard</h1>
  <button class="btn reject" onclick="logout()">Logout</button>
</header>

<!-- STATS -->
<div class="stats">
  <div class="stat">
    <h3>Total Users</h3>
    <p id="usersCount">‚Äì</p>
  </div>
  <div class="stat">
    <h3>Total Rides</h3>
    <p id="ridesCount">‚Äì</p>
  </div>
  <div class="stat">
    <h3>Pending Drivers</h3>
    <p id="driversCount">‚Äì</p>
  </div>
</div>

<!-- DRIVER APPLICATIONS -->
<div class="card">
  <h3>üöó Driver Verification Queue</h3>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Phone</th>
        <th>Vehicle</th>
        <th>Plate</th>
        <th>Docs</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="driversTable"></tbody>
  </table>
</div>

</div>

<!-- DOCUMENT MODAL -->
<div class="modal" id="docsModal">
  <div class="modal-content">
    <h3>üìÑ Driver Documents</h3>
    <div id="docsContent"></div>
    <button class="btn view" onclick="closeDocs()">Close</button>
  </div>
</div>

<!-- REJECT MODAL -->
<div class="modal" id="rejectModal">
  <div class="modal-content">
    <h3>Reject Driver</h3>
    <textarea id="rejectReason" placeholder="Reason for rejection"></textarea>
    <button class="btn reject" onclick="submitReject()">Submit</button>
  </div>
</div>

<script>
const API = "http://localhost:8000";
const token = localStorage.getItem("access_token");

let rejectDriverId = null;

function auth() {
  return {
    "Authorization": `Bearer ${token}`
  };
}

/* =========================
   LOAD STATS
========================= */
async function loadStats() {
  const res = await fetch(`${API}/admin/stats`, { headers: auth() });
  const data = await res.json();
  usersCount.textContent = data.users;
  ridesCount.textContent = data.rides;
  driversCount.textContent = data.pending_drivers;
}

/* =========================
   LOAD DRIVERS
========================= */
async function loadDrivers() {
  const res = await fetch(`${API}/admin/drivers/pending`, { headers: auth() });
  const drivers = await res.json();

  driversTable.innerHTML = "";

  drivers.forEach(d => {
    driversTable.innerHTML += `
      <tr>
        <td>${d.name}</td>
        <td>${d.phone}</td>
        <td>${d.vehicle_model}</td>
        <td>${d.plate}</td>
        <td>
          <button class="btn view" onclick="viewDocs(${d.id})">View</button>
        </td>
        <td><span class="badge pending">Pending</span></td>
        <td>
          <button class="btn approve" onclick="approve(${d.id})">Approve</button>
          <button class="btn reject" onclick="openReject(${d.id})">Reject</button>
        </td>
      </tr>
    `;
  });
}

/* =========================
   VIEW DOCUMENTS
========================= */
async function viewDocs(id) {
  const res = await fetch(`${API}/admin/drivers/${id}/documents`, { headers: auth() });
  const docs = await res.json();

  docsContent.innerHTML = `
    <p>ü™™ Ghana Card: ${docs.ghana_card ? "‚úî Uploaded" : "‚ùå Missing"}</p>
    <p>üöò Driver License: ${docs.license ? "‚úî Uploaded" : "‚ùå Missing"}</p>
    <p>üßæ Insurance: ${docs.insurance ? "‚úî Uploaded" : "‚ùå Missing"}</p>
    <p>üöó Vehicle Photos: ${docs.vehicle_photos?.length || 0}</p>
  `;

  docsModal.style.display = "flex";
}

function closeDocs() {
  docsModal.style.display = "none";
}

/* =========================
   APPROVE / REJECT
========================= */
async function approve(id) {
  await fetch(`${API}/admin/drivers/${id}/approve`, {
    method:"POST",
    headers:auth()
  });
  loadDrivers();
}

function openReject(id) {
  rejectDriverId = id;
  rejectModal.style.display = "flex";
}

async function submitReject() {
  await fetch(`${API}/admin/drivers/${rejectDriverId}/reject`, {
    method:"POST",
    headers:auth(),
    body:JSON.stringify({ reason: rejectReason.value })
  });
  rejectModal.style.display = "none";
  rejectReason.value = "";
  loadDrivers();
}

/* =========================
   LOGOUT
========================= */
function logout() {
  localStorage.clear();
  location.href = "auth.html";
}

/* INIT */
loadStats();
loadDrivers();
</script>

</body>
</html>
